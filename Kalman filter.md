# Kalman filter

整理关于kalman滤波有关的内容，毕竟这是一个很经典的滤波器。按照西工大自己的课程内容来整理。

### 最小二乘 | 最小方差

最小方差的部分稍等整理，先来看最小二乘的部分。因为最小二乘法是kalman滤波中的特例，而kalman又是一种最小方差的无偏估计方法。

1. 最小二乘
   - 最小二乘法计算起来比较简单，就是从均方误差来的，推导过程就是找到一个预估向量值，让整个均方误差取最小值。对$(z-H\hat{x})(z-H\hat{x})^T$求导，得出 $\hat{x}$取值
2. 加权最小二乘
   - 在最小二乘的基础上使用了权重(就是对预估向量值的不同分量，给定不同) -> 经过证明之后才能说明





​	通过测量值Z来计算实际的状态向量X，这就是估计。通过使用的估计指标不同，计算出来的x就有所不同。

​	最小二乘估计的对象是一个固定不变的状态向量X，使用的指标就是测量值Z与估计值X的误差要尽可能的小

**最小二乘**是对一个不变的状态向量来进行估计，也就是这个模型中只有观测模型，没有预测模型(这是kalman filter中的一个概念)，可以将模型简单写为Z=HX+V。

​	既然是最小方差估计，那么实际找到一个估计值让其使估计的噪声方差最小。因为已经假设了是白噪声，所以Cov(Z-HX) = E(Z-HX的转置乘以Z-HX)

开始一定是得到了关于状态向量的观测值Z，但是观测值与实际值还是有些区别，这个对应的就是误差。









PS: 无论是最小二乘还是卡尔曼滤波，本质上都是一种估计，提到估计就不得不知道这个估计是不是无偏估计(判断的方式很简单)，就是去判断这个估计量的均值是不是与真实值X相等即可。

参考链接：

1. https://blog.csdn.net/weixin_41558411/article/details/123585534 (关于最小二乘是无偏的证明)

    

    





对于kalman中提到的一些基本概念的补充(不知道这个概念是不是严老师独创的)，后面所提到的所有的变量都是多元的，毕竟kalman很少对一维系统进行分析。

- 协方差矩阵: 这是一个常见的概念，也就是多元变量中方差的拓展表示。这个矩阵中的对角线元素对应的是每一个分量自己的方差，其余部分就是分量与分量之间的协方差——计算方式为$E((x-x^-)(y-y^-))$，整体就是一个大的矩阵。

    - 实际对信号建模的时候，一般都会给出变量自己的协方差矩阵

        

- 均方误差矩阵：**均方误差实际上是真实值与预估值之间的差值的平方的均值**(虽然我不知道为什么对于一个预估值还存在这均值这种概念，从另一个角度来想，估计就是在测量值逐渐变多的情况下，估计量也会收敛到一个值左右，即为均值)。类比于协方差矩阵，对于一个多维变量，均方差误差的计算就可以认为是 $E\left( \left( X-\hat{X} \right) \left( X-\hat{X} \right) ^T \right) $​，有点类似协方差矩阵的计算，计算形式上非常接近，但是统计含义上还是有很大区别的。有些估计方法是将待估计变量所有分量的均方误差之和取最小，也就是将这个均方误差矩阵的迹取最小。而且使用这种矩阵计算而不是直接计算的好处是不是会引入更多的一些信息，即X自己的分量与其他分量之间计算了一个方程，物理意义不明确。

    

- 协均方误差矩阵：基于上述两种矩阵的进一步拓展，表示形式为$E\left( \left( X-\hat{X} \right) \left( Z-\hat{Z} \right) ^T \right) $，上面的均方误差对角线元素就是每一个分量自己与估计的均方误差，现在用协方差的表示来改写这个矩阵。实际上这个矩阵中的每一项都不是之前定义出来的均方误差。可以假设这种说法有一定意义，看看这一项在实际中如何使用的即可。这里与均方误差矩阵中的物理意义还不明确。



为什么量测一步预测用的是状态一步预测的结果来计算的。

![image-20240420001801775](figure/image-20240420001801775.png)







****

关于kalman滤波的设置





**最重要的一点**

在作业里面有关于状态方程以及量测方程的建模过程 -> 发现了一个很有意思的部分。

- 对于状态方程先从连续方程开始建立(即是现控对应的内容)，然后再离散化成为离散状态方程(这个时候噪声对应的方差等等都需要有一个转换 —— slam建模时IMU对应的测量方程上面也有类似的转换)





这个题目给出的题干就直接状态方程是需要手动转换成离散形式，雷达观测是直接写成了离散形式

![image-20240506024528804](./figure/image-20240506024528804.png)













****

在SLAM中对应的IMU测量方程也是从连续开始建模，一开始得出来的噪声等信息就是从连续时候开始定义的，转换成离散形式自然应该有离散对应的噪声均值与方差。

- 或者这种转换是不是依靠信号处理方面的转换关系，保证信号的功率谱密度什么的相等

![image-20240506024806436](./figure/image-20240506024806436.png)

- 这里时直接在测量方程上进行连续->离散转换

![image-20240506021239906](./figure/image-20240506021239906.png)

使用matlab对于信号进行可视化

```matlab
clc;
clear;
close all;
x =zeros(1,1000);
x(1) = 25;
for i = 1:1000-1
    w = normrnd(0,sqrt(0.4))
    x(i+1) = x(i)+ w;
end
% 绘制图像
plot(1:1000, x(1,:));
```

随机运行两次之后，本身一个固定在25的数值由于累计误差的影响，数据值的飘移情况很大

![image-20240506024006386](./figure/image-20240506024006386.png)





